"use strict";function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,s=[],l=!0,c=!1;try{if(a=(r=r.call(e)).next,0!==t)for(;!(l=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(c)throw o}}return s}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(e,t){var r,n,o,a,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return n=!(r=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return r=e.done,e},e:function(e){n=!0,o=e},f:function(){try{r||null==i.return||i.return()}finally{if(n)throw o}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t)return i&&(e=i),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var _Array$prototype,colors=["white","black"],files=["a","b","c","d","e","f","g","h"],ranks=["1","2","3","4","5","6","7","8"],invRanks=_toConsumableArray(ranks).reverse(),allKeys=(_Array$prototype=Array.prototype).concat.apply(_Array$prototype,_toConsumableArray(files.map(function(t){return ranks.map(function(e){return t+e})}))),pos2key=function(e){return allKeys[8*e[0]+e[1]]},key2pos=function(e){return[e.charCodeAt(0)-97,e.charCodeAt(1)-49]},allPos=allKeys.map(key2pos);function memo(e){function t(){return r=void 0===r?e():r}var r;return t.clear=function(){r=void 0},t}var timer=function(){var t;return{start:function(){t=performance.now()},cancel:function(){t=void 0},stop:function(){var e;return t?(e=performance.now()-t,t=void 0,e):0}}},opposite=function(e){return"white"===e?"black":"white"},distanceSq=function(e,t){var r=e[0]-t[0],e=e[1]-t[1];return r*r+e*e},samePiece=function(e,t){return e.role===t.role&&e.color===t.color},posToTranslate=function(r){return function(e,t){return[(t?e[0]:7-e[0])*r.width/8,(t?7-e[1]:e[1])*r.height/8]}},translate=function(e,t){e.style.transform="translate(".concat(t[0],"px,").concat(t[1],"px)")},translateAndScale=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;e.style.transform="translate(".concat(t[0],"px,").concat(t[1],"px) scale(").concat(r,")")},setVisible=function(e,t){e.style.visibility=t?"visible":"hidden"},eventPosition=function(e){var t;return e.clientX||0===e.clientX?[e.clientX,e.clientY]:null!=(t=e.targetTouches)&&t[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},isRightButton=function(e){return 2===e.buttons||2===e.button},createEl=function(e,t){e=document.createElement(e);return t&&(e.className=t),e};function computeSquareCenter(e,t,r){e=key2pos(e);return t||(e[0]=7-e[0],e[1]=7-e[1]),[r.left+r.width*e[0]/8+r.width/16,r.top+r.height*(7-e[1])/8+r.height/16]}var diff=function(e,t){return Math.abs(e-t)},pawn=function(o){return function(e,t,r,n){return diff(e,r)<2&&("white"===o?n===t+1||t<=1&&n===t+2&&e===r:n===t-1||6<=t&&n===t-2&&e===r)}},knight=function(e,t,r,n){e=diff(e,r),r=diff(t,n);return 1===e&&2===r||2===e&&1===r},bishop=function(e,t,r,n){return diff(e,r)===diff(t,n)},rook=function(e,t,r,n){return e===r||t===n},queen=function(e,t,r,n){return bishop(e,t,r,n)||rook(e,t,r,n)},king=function(o,a,i){return function(e,t,r,n){return diff(e,r)<2&&diff(t,n)<2||i&&t===n&&t===("white"===o?0:7)&&(4===e&&(2===r&&a.includes(0)||6===r&&a.includes(7))||a.includes(r))}};function rookFilesOf(e,t){var r,n="white"===t?"1":"8",o=[],a=_createForOfIteratorHelper(e);try{for(a.s();!(r=a.n()).done;){var i=_slicedToArray(r.value,2),s=i[0],l=i[1];s[1]===n&&l.color===t&&"rook"===l.role&&o.push(key2pos(s)[0])}}catch(e){a.e(e)}finally{a.f()}return o}function premove(e,t,r){var n,o,a=e.get(t);return a?(n=key2pos(t),t=a.role,o="pawn"===t?pawn(a.color):"knight"===t?knight:"bishop"===t?bishop:"rook"===t?rook:"queen"===t?queen:king(a.color,rookFilesOf(e,a.color),r),allPos.filter(function(e){return(n[0]!==e[0]||n[1]!==e[1])&&o(n[0],n[1],e[0],e[1])}).map(pos2key)):[]}function callUserFunction(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];e&&setTimeout(function(){return e.apply(void 0,r)},1)}function toggleOrientation(e){e.orientation=opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function setPieces(e,t){var r,n=_createForOfIteratorHelper(t);try{for(n.s();!(r=n.n()).done;){var o=_slicedToArray(r.value,2),a=o[0],i=o[1];i?e.pieces.set(a,i):e.pieces.delete(a)}}catch(e){n.e(e)}finally{n.f()}}function setCheck(e,t){if(t=!(e.check=void 0)===t?e.turnColor:t){var r,n=_createForOfIteratorHelper(e.pieces);try{for(n.s();!(r=n.n()).done;){var o=_slicedToArray(r.value,2),a=o[0],i=o[1];"king"===i.role&&i.color===t&&(e.check=a)}}catch(e){n.e(e)}finally{n.f()}}}function setPremove(e,t,r,n){unsetPredrop(e),e.premovable.current=[t,r],callUserFunction(e.premovable.events.set,t,r,n)}function unsetPremove(e){e.premovable.current&&(e.premovable.current=void 0,callUserFunction(e.premovable.events.unset))}function setPredrop(e,t,r){unsetPremove(e),e.predroppable.current={role:t,key:r},callUserFunction(e.predroppable.events.set,t,r)}function unsetPredrop(e){e=e.predroppable;e.current&&(e.current=void 0,callUserFunction(e.events.unset))}function tryAutoCastle(e,t,r){if(!e.autoCastle)return!1;var n=e.pieces.get(t);if(!n||"king"!==n.role)return!1;var o=key2pos(t),a=key2pos(r);if(0!==o[1]&&7!==o[1]||o[1]!==a[1])return!1;4!==o[0]||e.pieces.has(r)||(6===a[0]?r=pos2key([7,a[1]]):2===a[0]&&(r=pos2key([0,a[1]])));var i=e.pieces.get(r);return!(!i||i.color!==n.color||"rook"!==i.role||(e.pieces.delete(t),e.pieces.delete(r),o[0]<a[0]?(e.pieces.set(pos2key([6,a[1]]),n),e.pieces.set(pos2key([5,a[1]]),i)):(e.pieces.set(pos2key([2,a[1]]),n),e.pieces.set(pos2key([3,a[1]]),i)),0))}function baseMove(e,t,r){var n=e.pieces.get(t),o=e.pieces.get(r);return!(t===r||!n)&&(o=o&&o.color!==n.color?o:void 0,r===e.selected&&unselect(e),callUserFunction(e.events.move,t,r,o),tryAutoCastle(e,t,r)||(e.pieces.set(r,n),e.pieces.delete(t)),e.lastMove=[t,r],e.check=void 0,callUserFunction(e.events.change),o||!0)}function baseNewPiece(e,t,r,n){if(e.pieces.has(r)){if(!n)return!1;e.pieces.delete(r)}return callUserFunction(e.events.dropNewPiece,t,r),e.pieces.set(r,t),e.lastMove=[r],e.check=void 0,callUserFunction(e.events.change),e.movable.dests=void 0,e.turnColor=opposite(e.turnColor),!0}function baseUserMove(e,t,r){t=baseMove(e,t,r);return t&&(e.movable.dests=void 0,e.turnColor=opposite(e.turnColor),e.animation.current=void 0),t}function userMove(e,t,r){if(canMove(e,t,r)){var n,o=baseUserMove(e,t,r);if(o)return n=e.hold.stop(),unselect(e),n={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:n},!0!==o&&(n.captured=o),callUserFunction(e.movable.events.after,t,r,n),!0}else if(canPremove(e,t,r))return setPremove(e,t,r,{ctrlKey:e.stats.ctrlKey}),unselect(e),!0;return unselect(e),!1}function dropNewPiece(e,t,r,n){var o=e.pieces.get(t);o&&(canDrop(e,t,r)||n)?(e.pieces.delete(t),baseNewPiece(e,o,r,n),callUserFunction(e.movable.events.afterNewPiece,o.role,r,{premove:!1,predrop:!1})):o&&canPredrop(e,t,r)?setPredrop(e,o.role,r):(unsetPremove(e),unsetPredrop(e)),e.pieces.delete(t),unselect(e)}function selectSquare(e,t,r){if(callUserFunction(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled)return unselect(e),void e.hold.cancel();if((e.selectable.enabled||r)&&e.selected!==t&&userMove(e,e.selected,t))return void(e.stats.dragged=!1)}(e.selectable.enabled||e.draggable.enabled)&&(isMovable(e,t)||isPremovable(e,t))&&(setSelected(e,t),e.hold.start())}function setSelected(e,t){e.selected=t,isPremovable(e,t)?e.premovable.customDests||(e.premovable.dests=premove(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function unselect(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function isMovable(e,t){t=e.pieces.get(t);return!!t&&("both"===e.movable.color||e.movable.color===t.color&&e.turnColor===t.color)}var canMove=function(e,t,r){return t!==r&&isMovable(e,t)&&(e.movable.free||!(null==(e=null==(e=e.movable.dests)?void 0:e.get(t))||!e.includes(r)))};function canDrop(e,t,r){var n=e.pieces.get(t);return!(!n||t!==r&&e.pieces.has(r)||"both"!==e.movable.color&&(e.movable.color!==n.color||e.turnColor!==n.color))}function isPremovable(e,t){t=e.pieces.get(t);return!!t&&e.premovable.enabled&&e.movable.color===t.color&&e.turnColor!==t.color}function canPremove(e,t,r){var n=null!=(n=null==(n=e.premovable.customDests)?void 0:n.get(t))?n:premove(e.pieces,t,e.premovable.castle);return t!==r&&isPremovable(e,t)&&n.includes(r)}function canPredrop(e,t,r){var t=e.pieces.get(t),n=e.pieces.get(r);return!!t&&(!n||n.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==t.role||"1"!==r[1]&&"8"!==r[1])&&e.movable.color===t.color&&e.turnColor!==t.color}function isDraggable(e,t){t=e.pieces.get(t);return!!t&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===t.color&&(e.turnColor===t.color||e.premovable.enabled))}function playPremove(e){var t,r,n,o,a=e.premovable.current;return!!a&&(t=a[0],a=a[1],r=!1,canMove(e,t,a)&&(n=baseUserMove(e,t,a))&&(o={premove:!0},!0!==n&&(o.captured=n),callUserFunction(e.movable.events.after,t,a,o),r=!0),unsetPremove(e),r)}function playPredrop(e,t){var r=e.predroppable.current,n=!1;return!!r&&(t(r)&&baseNewPiece(e,{role:r.role,color:e.movable.color},r.key)&&(callUserFunction(e.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),n=!0),unsetPredrop(e),n)}function cancelMove(e){unsetPremove(e),unsetPredrop(e),unselect(e)}function stop(e){e.movable.color=e.movable.dests=e.animation.current=void 0,cancelMove(e)}function getKeyAtDomPos(e,t,r){var n=Math.floor(8*(e[0]-r.left)/r.width),e=(t||(n=7-n),7-Math.floor(8*(e[1]-r.top)/r.height));return t||(e=7-e),0<=n&&n<8&&0<=e&&e<8?pos2key([n,e]):void 0}function getSnappedKeyAtDomPos(e,t,r,n){var o=key2pos(e),e=allPos.filter(function(e){return queen(o[0],o[1],e[0],e[1])||knight(o[0],o[1],e[0],e[1])}),a=e.map(function(e){return computeSquareCenter(pos2key(e),r,n)}).map(function(e){return distanceSq(t,e)}),a=_slicedToArray(a.reduce(function(e,t,r){return e[0]<t?e:[t,r]},[a[0],0]),2)[1];return pos2key(e[a])}var whitePov=function(e){return"white"===e.orientation},initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",roles={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},letters={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function read(e){"start"===e&&(e=initial);var t,r=new Map,n=7,o=0,a=_createForOfIteratorHelper(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;switch(i){case" ":case"[":return r;case"/":if(--n<0)return r;o=0;break;case"~":var s=r.get(pos2key([o-1,n]));s&&(s.promoted=!0);break;default:var l,c=i.charCodeAt(0);c<57?o+=c-48:(l=i.toLowerCase(),r.set(pos2key([o,n]),{role:roles[l],color:i===l?"black":"white"}),++o)}}}catch(e){a.e(e)}finally{a.f()}return r}function write(n){return invRanks.map(function(r){return files.map(function(e){var t,e=n.get(e+r);return e?(t=letters[e.role],"white"===e.color&&(t=t.toUpperCase()),e.promoted&&(t+="~"),t):"1"}).join("")}).join("/").replace(/1{2,}/g,function(e){return e.length.toString()})}function applyAnimation(e,t){t.animation&&(deepMerge(e.animation,t.animation),(e.animation.duration||0)<70)&&(e.animation.enabled=!1)}function configure(e,t){var r,n,o;null!=(n=t.movable)&&n.dests&&(e.movable.dests=void 0),null!=(n=t.drawable)&&n.autoShapes&&(e.drawable.autoShapes=[]),deepMerge(e,t),t.fen&&(e.pieces=read(t.fen),e.drawable.shapes=(null==(n=t.drawable)?void 0:n.shapes)||[]),"check"in t&&setCheck(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&setSelected(e,e.selected),applyAnimation(e,t),!e.movable.rookCastle&&e.movable.dests&&(r="white"===e.movable.color?"1":"8",o=e.movable.dests.get(n="e"+r),t=e.pieces.get(n),o)&&t&&"king"===t.role&&e.movable.dests.set(n,o.filter(function(e){return!(e==="a"+r&&o.includes("c"+r)||e==="h"+r&&o.includes("g"+r))}))}function deepMerge(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)&&isPlainObject(e[r])&&isPlainObject(t[r])?deepMerge(e[r],t[r]):e[r]=t[r])}function isPlainObject(e){return"object"===_typeof(e)&&null!==e&&((e=Object.getPrototypeOf(e))===Object.prototype||null===e)}var anim=function(e,t){return(t.animation.enabled?animate:render$2)(e,t)};function render$2(e,t){e=e(t);return t.dom.redraw(),e}var makePiece=function(e,t){return{key:e,pos:key2pos(e),piece:t}},closer=function(r,e){return e.sort(function(e,t){return distanceSq(r.pos,e.pos)-distanceSq(r.pos,t.pos)})[0]};function computePlan(e,t){var r,n,o=new Map,a=[],i=new Map,s=[],l=[],c=new Map,u=_createForOfIteratorHelper(e);try{for(u.s();!(n=u.n()).done;){var d=_slicedToArray(n.value,2),p=d[0],f=d[1];c.set(p,makePiece(p,f))}}catch(e){u.e(e)}finally{u.f()}var v,h=_createForOfIteratorHelper(allKeys);try{for(h.s();!(v=h.n()).done;){var m=v.value,g=t.pieces.get(m),b=c.get(m);g?b?samePiece(g,b.piece)||(s.push(b),l.push(makePiece(m,g))):l.push(makePiece(m,g)):b&&s.push(b)}}catch(e){h.e(e)}finally{h.f()}for(var y=0,w=l;y<w.length;y++)!function(){var t=w[y];(b=closer(t,s.filter(function(e){return samePiece(t.piece,e.piece)})))&&(r=[b.pos[0]-t.pos[0],b.pos[1]-t.pos[1]],o.set(t.key,r.concat(r)),a.push(b.key))}();for(var k=0,P=s;k<P.length;k++){var S=P[k];a.includes(S.key)||i.set(S.key,S.piece)}return{anims:o,fadings:i}}function step(t,e){var r=t.animation.current;if(void 0===r)t.dom.destroyed||t.dom.redrawNow();else{e=1-(e-r.start)*r.frequency;if(e<=0)t.animation.current=void 0,t.dom.redrawNow();else{var n,o=easing(e),a=_createForOfIteratorHelper(r.plan.anims.values());try{for(a.s();!(n=a.n()).done;){var i=n.value;i[2]=i[0]*o,i[3]=i[1]*o}}catch(e){a.e(e)}finally{a.f()}t.dom.redrawNow(!0),requestAnimationFrame(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:performance.now();return step(t,e)})}}}function animate(e,t){var r,n=new Map(t.pieces),e=e(t),n=computePlan(n,t);return n.anims.size||n.fadings.size?(r=t.animation.current&&t.animation.current.start,t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:n},r||step(t,performance.now())):t.dom.redraw(),e}var easing=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},brushes=["green","red","blue","yellow"];function start$2(e,t){var r,n;t.touches&&1<t.touches.length||(t.stopPropagation(),t.preventDefault(),(t.ctrlKey?unselect:cancelMove)(e),(n=getKeyAtDomPos(r=eventPosition(t),whitePov(e),e.dom.bounds()))&&(e.drawable.current={orig:n,pos:r,brush:eventBrush(t),snapToValidMove:e.drawable.defaultSnapToValidMove},processDraw(e)))}function processDraw(r){requestAnimationFrame(function(){var e,t=r.drawable.current;t&&((e=getKeyAtDomPos(t.pos,whitePov(r),r.dom.bounds()))||(t.snapToValidMove=!1),(e=t.snapToValidMove?getSnappedKeyAtDomPos(t.orig,t.pos,whitePov(r),r.dom.bounds()):e)!==t.mouseSq&&(t.mouseSq=e,t.dest=e!==t.orig?e:void 0,r.dom.redrawNow()),processDraw(r))})}function move$1(e,t){e.drawable.current&&(e.drawable.current.pos=eventPosition(t))}function end$1(e){var t=e.drawable.current;t&&(t.mouseSq&&addShape(e.drawable,t),cancel$1(e))}function cancel$1(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function clear(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),onChange(e.drawable))}function eventBrush(e){var t=(e.shiftKey||e.ctrlKey)&&isRightButton(e),r=e.altKey||e.metaKey||(null==(r=e.getModifierState)?void 0:r.call(e,"AltGraph"));return brushes[(t?1:0)+(r?2:0)]}function addShape(e,t){function r(e){return e.orig===t.orig&&e.dest===t.dest}var n=e.shapes.find(r);n&&(e.shapes=e.shapes.filter(function(e){return!r(e)})),n&&n.brush===t.brush||e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),onChange(e)}function onChange(e){e.onChange&&e.onChange(e.shapes)}function start$1(e,t){if((e.trustAllEvents||t.isTrusted)&&!(void 0!==t.button&&0!==t.button||t.touches&&1<t.touches.length)){var r=e.dom.bounds(),n=eventPosition(t),o=getKeyAtDomPos(n,whitePov(e),r);if(o){var a=e.pieces.get(o),i=e.selected;if(i||!e.drawable.enabled||!e.drawable.eraseOnClick&&a&&a.color===e.turnColor||clear(e),!1!==t.cancelable&&(!t.touches||e.blockTouchScroll||a||i||pieceCloseTo(e,n)))t.preventDefault();else if(t.touches)return;var s=!!e.premovable.current,l=!!e.predroppable.current,c=(e.stats.ctrlKey=t.ctrlKey,e.selected&&canMove(e,e.selected,o)?anim(function(e){return selectSquare(e,o)},e):selectSquare(e,o),e.selected===o),u=pieceElementByKey(e,o);a&&u&&c&&isDraggable(e,o)?(e.draggable.current={orig:o,piece:a,origPos:n,pos:n,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:i,originTarget:t.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add("dragging"),(c=e.dom.elements.ghost)&&(c.className="ghost ".concat(a.color," ").concat(a.role),translate(c,posToTranslate(r)(key2pos(o),whitePov(e))),setVisible(c,!0)),processDrag(e)):(s&&unsetPremove(e),l&&unsetPredrop(e)),e.dom.redraw()}}}function pieceCloseTo(e,t){var r,n=whitePov(e),o=e.dom.bounds(),a=Math.pow(o.width/8,2),i=_createForOfIteratorHelper(e.pieces.keys());try{for(i.s();!(r=i.n()).done;){var s=computeSquareCenter(r.value,n,o);if(distanceSq(s,t)<=a)return!0}}catch(e){i.e(e)}finally{i.f()}return!1}function dragNewPiece(e,t,r,n){e.pieces.set("a0",t),e.dom.redraw();var o=eventPosition(r);e.draggable.current={orig:"a0",piece:t,origPos:o,pos:o,started:!0,element:function(){return pieceElementByKey(e,"a0")},originTarget:r.target,newPiece:!0,force:!!n,keyHasChanged:!1},processDrag(e)}function processDrag(r){requestAnimationFrame(function(){var e=r.draggable.current;if(e){null!=(t=r.animation.current)&&t.plan.anims.has(e.orig)&&(r.animation.current=void 0);var t=r.pieces.get(e.orig);if(t&&samePiece(t,e.piece)){if(!e.started&&distanceSq(e.pos,e.origPos)>=Math.pow(r.draggable.distance,2)&&(e.started=!0),e.started){if("function"==typeof e.element){t=e.element();if(!t)return;t.cgDragging=!0,t.classList.add("dragging"),e.element=t}t=r.dom.bounds();translate(e.element,[e.pos[0]-t.left-t.width/16,e.pos[1]-t.top-t.height/16]),e.keyHasChanged||(e.keyHasChanged=e.orig!==getKeyAtDomPos(e.pos,whitePov(r),t))}}else cancel(r);processDrag(r)}})}function move(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=eventPosition(t))}function end(e,t){var r,n=e.draggable.current;n&&("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"!==t.type||n.originTarget===t.target||n.newPiece?(unsetPremove(e),unsetPredrop(e),(r=getKeyAtDomPos(eventPosition(t)||n.pos,whitePov(e),e.dom.bounds()))&&n.started&&n.orig!==r?n.newPiece?dropNewPiece(e,n.orig,r,n.force):(e.stats.ctrlKey=t.ctrlKey,userMove(e,n.orig,r)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!r&&(e.pieces.delete(n.orig),callUserFunction(e.events.change)),(n.orig!==n.previouslySelected&&!n.keyHasChanged||n.orig!==r&&r)&&e.selectable.enabled||unselect(e),removeDragElements(e),e.draggable.current=void 0,e.dom.redraw()):e.draggable.current=void 0)}function cancel(e){var t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,unselect(e),removeDragElements(e),e.dom.redraw())}function removeDragElements(e){e=e.dom.elements;e.ghost&&setVisible(e.ghost,!1)}function pieceElementByKey(e,t){for(var r=e.dom.elements.board.firstChild;r;){if(r.cgKey===t&&"PIECE"===r.tagName)return r;r=r.nextSibling}}function explosion(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(function(){setStage(e,2),setTimeout(function(){return setStage(e,void 0)},120)},120)}function setStage(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function start(n,e){function r(){toggleOrientation(n),e()}return{set:function(t){t.orientation&&t.orientation!==n.orientation&&r(),applyAnimation(n,t),(t.fen?anim:render$2)(function(e){return configure(e,t)},n)},state:n,getFen:function(){return write(n.pieces)},toggleOrientation:r,setPieces:function(t){anim(function(e){return setPieces(e,t)},n)},selectSquare:function(t,r){t?anim(function(e){return selectSquare(e,t,r)},n):n.selected&&(unselect(n),n.dom.redraw())},move:function(t,r){anim(function(e){return baseMove(e,t,r)},n)},newPiece:function(t,r){anim(function(e){return baseNewPiece(e,t,r)},n)},playPremove:function(){if(n.premovable.current){if(anim(playPremove,n))return!0;n.dom.redraw()}return!1},playPredrop:function(e){return!!n.predroppable.current&&(e=playPredrop(n,e),n.dom.redraw(),e)},cancelPremove:function(){render$2(unsetPremove,n)},cancelPredrop:function(){render$2(unsetPredrop,n)},cancelMove:function(){render$2(function(e){cancelMove(e),cancel(e)},n)},stop:function(){render$2(function(e){stop(e),cancel(e)},n)},explode:function(e){explosion(n,e)},setAutoShapes:function(t){render$2(function(e){return e.drawable.autoShapes=t},n)},setShapes:function(t){render$2(function(e){return e.drawable.shapes=t},n)},getKeyAtDomPos:function(e){return getKeyAtDomPos(e,whitePov(n),n.dom.bounds())},redrawAll:e,dragNewPiece:function(e,t,r){dragNewPiece(n,e,t,r)},destroy:function(){stop(n),n.dom.unbind&&n.dom.unbind(),n.dom.destroyed=!0}}}function defaults(){return{pieces:read(initial),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purp",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},hilite:{key:"hilite",color:"#fff",opacity:1,lineWidth:1}},prevSvgHash:""},hold:timer()}}function createDefs(){var e=createElement("defs"),t=setAttributes(createElement("filter"),{id:"cg-filter-blur"});return t.appendChild(setAttributes(createElement("feGaussianBlur"),{stdDeviation:"0.022"})),e.appendChild(t),e}function renderSvg(t,e,r){var n,o,a=t.drawable,i=a.current,i=i&&i.mouseSq?i:void 0,s=new Map,l=t.dom.bounds(),c=a.autoShapes.filter(function(e){return!e.piece}),u=_createForOfIteratorHelper(a.shapes.concat(c).concat(i?[i]:[]));try{for(u.s();!(o=u.n()).done;){var d,p,f,v=o.value;v.dest&&(d=null!=(n=s.get(v.dest))?n:new Set,p=pos2user(orient(key2pos(v.orig),t.orientation),l),f=pos2user(orient(key2pos(v.dest),t.orientation),l),d.add(moveAngle(p,f)),s.set(v.dest,d))}}catch(e){u.e(e)}finally{u.f()}c=a.shapes.concat(c).map(function(e){return{shape:e,current:!1,hash:shapeHash(e,isShort(e.dest,s),!1,l)}}),i&&c.push({shape:i,current:!0,hash:shapeHash(i,isShort(i.dest,s),!0,l)}),i=c.map(function(e){return e.hash}).join(";");i!==t.drawable.prevSvgHash&&(t.drawable.prevSvgHash=i,i=e.querySelector("defs"),syncDefs(a,c,i),syncShapes$1(c,e.querySelector("g"),r.querySelector("g"),function(e){return renderShape$1(t,e,a.brushes,s,l)}))}function syncDefs(e,t,r){var n,o,a,i=new Map,s=_createForOfIteratorHelper(t);try{for(s.s();!(a=s.n()).done;){var l=a.value;l.shape.dest&&(o=makeCustomBrush(e.brushes[l.shape.brush],l.shape.modifiers),null!=(n=l.shape.modifiers)&&n.hilite&&i.set("hilite",e.brushes.hilite),i.set(o.key,o))}}catch(e){s.e(e)}finally{s.f()}for(var c=new Set,u=r.firstElementChild;u;)c.add(u.getAttribute("cgKey")),u=u.nextElementSibling;var d,p=_createForOfIteratorHelper(i.entries());try{for(p.s();!(d=p.n()).done;){var f=_slicedToArray(d.value,2),v=f[0],h=f[1];c.has(v)||r.appendChild(renderMarker(h))}}catch(e){p.e(e)}finally{p.f()}}function syncShapes$1(e,t,r,n){var o,a=new Map,i=_createForOfIteratorHelper(e);try{for(i.s();!(o=i.n()).done;){var s=o.value;a.set(s.hash,!1)}}catch(e){i.e(e)}finally{i.f()}for(var l=0,c=[t,r];l<c.length;l++){for(var u,d=c[l],p=[],f=d.firstElementChild;f;)u=f.getAttribute("cgHash"),a.has(u)?a.set(u,!0):p.push(f),f=f.nextElementSibling;for(var v=0,h=p;v<h.length;v++)d.removeChild(h[v])}var m,g=_createForOfIteratorHelper(e.filter(function(e){return!a.get(e.hash)}));try{for(g.s();!(m=g.n()).done;){var b,y=_createForOfIteratorHelper(n(m.value));try{for(y.s();!(b=y.n()).done;){var w=b.value;(w.isCustom?r:t).appendChild(w.el)}}catch(e){y.e(e)}finally{y.f()}}}catch(e){g.e(e)}finally{g.f()}}function shapeHash(e,t,r,n){var o=e.orig,a=e.dest,i=e.brush,s=e.piece,l=e.modifiers,c=e.customSvg,e=e.label;return[n.width,n.height,r,o,a,i,t&&"-",s&&pieceHash(s),l&&modifiersHash(l),c&&"custom-".concat(textHash(c)),e&&"label-".concat(textHash(e.text))].filter(function(e){return e}).join(",")}function pieceHash(e){return[e.color,e.role,e.scale].filter(function(e){return e}).join(",")}function modifiersHash(e){return[e.lineWidth,e.hilite&&"*",null==(e=e.overlayCustomSvg)?void 0:e[0]].filter(function(e){return e}).join(",")}function textHash(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)>>>0;return t.toString()}function renderShape$1(e,t,r,n,o){var a,i=t.shape,s=t.current,t=t.hash,l=pos2user(orient(key2pos(i.orig),e.orientation),o),e=i.dest?pos2user(orient(key2pos(i.dest),e.orientation),o):l,c=makeCustomBrush(r[i.brush],i.modifiers),u=n.get(i.dest),d=[];return(!i.customSvg||null!=(a=i.modifiers)&&a.overlayCustomSvg)&&(a=setAttributes(createElement("g"),{cgHash:t}),d.push({el:a}),l[0]!==e[0]||l[1]!==e[1]?a.appendChild(renderArrow(i,c,l,e,s,isShort(i.dest,n))):a.appendChild(renderCircle(r[i.brush],l,s,o)),i.label)&&d.push({el:renderLabel(i.label.text,c.color,t,l,e,u),isCustom:!0}),i.customSvg&&(o=(s=_slicedToArray("label"===(r=null!=(a=null==(n=i.modifiers)?void 0:n.overlayCustomSvg)?a:"orig")?labelCoords(l,e,u):"dest"===r?e:l,2))[0],c=s[1],(n=setAttributes(createElement("g"),{transform:"translate(".concat(o,",").concat(c,")"),cgHash:t})).innerHTML='<svg width="1" height="1" viewBox="0 0 100 100">'.concat(i.customSvg,"</svg>"),d.push({el:n,isCustom:!0})),d}function renderCircle(e,t,r,n){var o=circleWidth(),n=(n.width+n.height)/(4*Math.max(n.width,n.height));return setAttributes(createElement("circle"),{stroke:e.color,"stroke-width":o[r?0:1],fill:"none",opacity:opacity(e,r),cx:t[0],cy:t[1],r:n-o[1]/2})}function renderArrow(o,a,i,s,l,c){var e,t;function r(e){var t=arrowMargin(c&&!l),r=s[0]-i[0],n=s[1]-i[1],n=Math.atan2(n,r),r=Math.cos(n)*t,n=Math.sin(n)*t;return setAttributes(createElement("line"),{stroke:e?"white":a.color,"stroke-width":lineWidth(a,l)+(e?.04:0),"stroke-linecap":"round","marker-end":"url(#arrowhead-".concat(e?"hilite":a.key,")"),opacity:null!=(t=o.modifiers)&&t.hilite?1:opacity(a,l),x1:i[0],y1:i[1],x2:s[0]-r,y2:s[1]-n})}return null!=(e=o.modifiers)&&e.hilite?(e=createElement("g"),(t=setAttributes(createElement("g"),{filter:"url(#cg-filter-blur)"})).appendChild(filterBox(i,s)),t.appendChild(r(!0)),e.appendChild(t),e.appendChild(r(!1)),e):r(!1)}function renderMarker(e){var t=setAttributes(createElement("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:"hilite"===e.key?1.86:2.05,refY:2});return t.appendChild(setAttributes(createElement("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function renderLabel(e,t,r,n,o,a){var i=.4*Math.pow(.8,e.length),n=_slicedToArray(labelCoords(n,o,a),2),o=n[0],a=n[1],n=setAttributes(createElement("g"),{transform:"translate(".concat(o+.5,",").concat(a+.5,")"),cgHash:r}),o=(n.appendChild(setAttributes(createElement("circle"),{r:.2,"fill-opacity":.8,"stroke-opacity":.7,"stroke-width":.03,fill:t,stroke:"white"})),setAttributes(createElement("text"),{"font-size":i,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.34*i,innerHTML:e}));return o.innerHTML=e,n.appendChild(o),n}function orient(e,t){return"white"===t?e:[7-e[0],7-e[1]]}function isShort(e,t){return!0===(e&&t.has(e)&&1<t.get(e).size)}function createElement(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function setAttributes(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.setAttribute(r,t[r]);return e}function makeCustomBrush(e,t){return t?{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(function(e){return e}).join("")}:e}function circleWidth(){return[3/64,4/64]}function lineWidth(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function opacity(e,t){return(e.opacity||1)*(t?.9:1)}function arrowMargin(e){return(e?20:10)/64}function pos2user(e,t){var r=Math.min(1,t.width/t.height),t=Math.min(1,t.height/t.width);return[(e[0]-3.5)*r,(3.5-e[1])*t]}function filterBox(e,t){e={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return setAttributes(createElement("rect"),{x:e.from[0],y:e.from[1],width:e.to[0]-e.from[0],height:e.to[1]-e.from[1],fill:"none",stroke:"none"})}function moveAngle(e,t){var r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],t=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return r?(Math.round(8*t/Math.PI)+16)%16:t}function dist(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce(function(e,t){return e+t*t},0))}function labelCoords(e,t,r){var n,o=dist(e,t);return 0===o?[.5+e[0],.5+e[1]]:(n=moveAngle(e,t,!1),r&&(o-=33/64,1<r.size)&&(o-=10/64,t=moveAngle(e,t),r.has((t+1)%16)||r.has((t+15)%16))&&1&t&&(o-=.4),[e[0]-Math.cos(n)*o,e[1]-Math.sin(n)*o])}function renderWrap(e,t){e.innerHTML="",e.classList.add("cg-wrap");var r,n=_createForOfIteratorHelper(colors);try{for(n.s();!(r=n.n()).done;){var o=r.value;e.classList.toggle("orientation-"+o,t.orientation===o)}}catch(e){n.e(e)}finally{n.f()}e.classList.toggle("manipulable",!t.viewOnly);var a,i,s,l,c,u,d=createEl("cg-container"),p=(e.appendChild(d),createEl("cg-board"));return d.appendChild(p),t.drawable.visible&&((a=setAttributes(createElement("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"})).appendChild(createDefs()),a.appendChild(createElement("g")),(i=setAttributes(createElement("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"})).appendChild(createElement("g")),s=createEl("cg-auto-pieces"),d.appendChild(a),d.appendChild(i),d.appendChild(s)),t.coordinates&&(l="black"===t.orientation?" black":"",c="left"===t.ranksPosition?" left":"",d.appendChild(renderCoords(ranks,"ranks"+l+c)),d.appendChild(renderCoords(files,"files"+l))),t.draggable.enabled&&t.draggable.showGhost&&(u=createEl("piece","ghost"),setVisible(u,!1),d.appendChild(u)),{board:p,container:d,wrap:e,ghost:u,svg:a,customSvg:i,autoPieces:s}}function renderCoords(e,t){var r,n=createEl("coords",t),o=_createForOfIteratorHelper(e);try{for(o.s();!(r=o.n()).done;){var a,i=r.value;(a=createEl("coord")).textContent=i,n.appendChild(a)}}catch(e){o.e(e)}finally{o.f()}return n}function drop(e,t){var r;e.dropmode.active&&(unsetPremove(e),unsetPredrop(e),(r=e.dropmode.piece)&&(e.pieces.set("a0",r),t=(r=eventPosition(t))&&getKeyAtDomPos(r,whitePov(e),e.dom.bounds()))&&dropNewPiece(e,"a0",t),e.dom.redraw())}function bindBoard(e,t){var r=e.dom.elements.board;"ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&r.addEventListener("contextmenu",function(e){return e.preventDefault()}),e.viewOnly||(t=startDragOrDraw(e),r.addEventListener("touchstart",t,{passive:!1}),r.addEventListener("mousedown",t,{passive:!1}))}function bindDocument(e,t){var r=[];if("ResizeObserver"in window||r.push(unbindable(document.body,"chessground.resize",t)),!e.viewOnly){for(var n=dragOrDraw(e,move,move$1),o=dragOrDraw(e,end,end$1),a=0,i=["touchmove","mousemove"];a<i.length;a++)r.push(unbindable(document,i[a],n));for(var s=0,l=["touchend","mouseup"];s<l.length;s++)r.push(unbindable(document,l[s],o));t=function(){return e.dom.bounds.clear()};r.push(unbindable(document,"scroll",t,{capture:!0,passive:!0})),r.push(unbindable(window,"resize",t,{passive:!0}))}return function(){return r.forEach(function(e){return e()})}}function unbindable(e,t,r,n){return e.addEventListener(t,r,n),function(){return e.removeEventListener(t,r,n)}}var startDragOrDraw=function(t){return function(e){t.draggable.current?cancel(t):t.drawable.current?cancel$1(t):e.shiftKey||isRightButton(e)?t.drawable.enabled&&start$2(t,e):t.viewOnly||(t.dropmode.active?drop:start$1)(t,e)}},dragOrDraw=function(t,r,n){return function(e){t.drawable.current?t.drawable.enabled&&n(t,e):t.viewOnly||r(t,e)}};function render$1(e){for(var t=whitePov(e),r=posToTranslate(e.dom.bounds()),n=e.dom.elements.board,o=e.pieces,a=e.animation.current,i=a?a.plan.anims:new Map,q=a?a.plan.fadings:new Map,s=e.draggable.current,l=computeSquareClasses(e),c=new Set,u=new Set,d=new Map,p=new Map,f=n.firstChild;f;){var v,h,m,g,b,y=f.cgKey;isPieceNode(f)?(v=o.get(y),h=i.get(y),m=q.get(y),g=f.cgPiece,!f.cgDragging||s&&s.orig===y||(f.classList.remove("dragging"),translate(f,r(key2pos(y),t)),f.cgDragging=!1),!m&&f.cgFading&&(f.cgFading=!1,f.classList.remove("fading")),v?(h&&f.cgAnimating&&g===pieceNameOf(v)?((b=key2pos(y))[0]+=h[2],b[1]+=h[3],f.classList.add("anim"),translate(f,r(b,t))):f.cgAnimating&&(f.cgAnimating=!1,f.classList.remove("anim"),translate(f,r(key2pos(y),t)),e.addPieceZIndex)&&(f.style.zIndex=posZIndex(key2pos(y),t)),g!==pieceNameOf(v)||m&&f.cgFading?m&&g===pieceNameOf(m)?(f.classList.add("fading"),f.cgFading=!0):appendValue(d,g,f):c.add(y)):appendValue(d,g,f)):isSquareNode(f)&&(b=f.className,l.get(y)===b?u.add(y):appendValue(p,b,f)),f=f.nextSibling}var w,k=_createForOfIteratorHelper(l);try{for(k.s();!(w=k.n()).done;){var P,S,C,A,N=_slicedToArray(w.value,2),M=N[0],K=N[1];u.has(M)||(S=(P=p.get(K))&&P.pop(),C=r(key2pos(M),t),S?(S.cgKey=M,translate(S,C)):((A=createEl("square",K)).cgKey=M,translate(A,C),n.insertBefore(A,n.firstChild)))}}catch(e){k.e(e)}finally{k.f()}var L,O=_createForOfIteratorHelper(o);try{for(O.s();!(L=O.n()).done;){var _,E,T,H,$,x,B=_slicedToArray(L.value,2),D=B[0],W=B[1];h=i.get(D),c.has(D)||((x=($=d.get(pieceNameOf(W)))&&$.pop())?(x.cgKey=D,x.cgFading&&(x.classList.remove("fading"),x.cgFading=!1),_=key2pos(D),e.addPieceZIndex&&(x.style.zIndex=posZIndex(_,t)),h&&(x.cgAnimating=!0,x.classList.add("anim"),_[0]+=h[2],_[1]+=h[3]),translate(x,r(_,t))):(E=pieceNameOf(W),T=createEl("piece",E),H=key2pos(D),T.cgPiece=E,T.cgKey=D,h&&(T.cgAnimating=!0,H[0]+=h[2],H[1]+=h[3]),translate(T,r(H,t)),e.addPieceZIndex&&(T.style.zIndex=posZIndex(H,t)),n.appendChild(T)))}}catch(e){O.e(e)}finally{O.f()}var R,I=_createForOfIteratorHelper(d.values());try{for(I.s();!(R=I.n()).done;)removeNodes(e,R.value)}catch(e){I.e(e)}finally{I.f()}var j,F=_createForOfIteratorHelper(p.values());try{for(F.s();!(j=F.n()).done;)removeNodes(e,j.value)}catch(e){F.e(e)}finally{F.f()}}function renderResized$1(e){for(var t=whitePov(e),r=posToTranslate(e.dom.bounds()),n=e.dom.elements.board.firstChild;n;)(isPieceNode(n)&&!n.cgAnimating||isSquareNode(n))&&translate(n,r(key2pos(n.cgKey),t)),n=n.nextSibling}function updateBounds(e){var t=e.dom.elements.wrap.getBoundingClientRect(),r=e.dom.elements.container,n=t.height/t.width,t=8*Math.floor(t.width*window.devicePixelRatio/8)/window.devicePixelRatio,n=t*n;r.style.width=t+"px",r.style.height=n+"px",e.dom.bounds.clear(),null!=(r=e.addDimensionsCssVarsTo)&&r.style.setProperty("--cg-width",t+"px"),null!=(r=e.addDimensionsCssVarsTo)&&r.style.setProperty("--cg-height",n+"px")}var isPieceNode=function(e){return"PIECE"===e.tagName},isSquareNode=function(e){return"SQUARE"===e.tagName};function removeNodes(e,t){var r,n=_createForOfIteratorHelper(t);try{for(n.s();!(r=n.n()).done;){var o=r.value;e.dom.elements.board.removeChild(o)}}catch(e){n.e(e)}finally{n.f()}}function posZIndex(e,t){e=e[1];return"".concat(t?10-e:3+e)}var pieceNameOf=function(e){return"".concat(e.color," ").concat(e.role)};function computeSquareClasses(e){var r=new Map;if(e.lastMove&&e.highlight.lastMove){var t,n=_createForOfIteratorHelper(e.lastMove);try{for(n.s();!(t=n.n()).done;){var o=t.value;addSquare(r,o,"last-move")}}catch(e){n.e(e)}finally{n.f()}}if(e.check&&e.highlight.check&&addSquare(r,e.check,"check"),e.selected&&(addSquare(r,e.selected,"selected"),e.movable.showDests)){var a=null==(a=e.movable.dests)?void 0:a.get(e.selected);if(a){var i,s=_createForOfIteratorHelper(a);try{for(s.s();!(i=s.n()).done;){var l=i.value;addSquare(r,l,"move-dest"+(e.pieces.has(l)?" oc":""))}}catch(e){s.e(e)}finally{s.f()}}a=null!=(a=null==(a=e.premovable.customDests)?void 0:a.get(e.selected))?a:e.premovable.dests;if(a){var c,u=_createForOfIteratorHelper(a);try{for(u.s();!(c=u.n()).done;){var d=c.value;addSquare(r,d,"premove-dest"+(e.pieces.has(d)?" oc":""))}}catch(e){u.e(e)}finally{u.f()}}}a=e.premovable.current;if(a){var p,f=_createForOfIteratorHelper(a);try{for(f.s();!(p=f.n()).done;){var v=p.value;addSquare(r,v,"current-premove")}}catch(e){f.e(e)}finally{f.f()}}else e.predroppable.current&&addSquare(r,e.predroppable.current.key,"current-premove");var h=e.exploding;if(h){var m,g=_createForOfIteratorHelper(h.keys);try{for(g.s();!(m=g.n()).done;){var b=m.value;addSquare(r,b,"exploding"+h.stage)}}catch(e){g.e(e)}finally{g.f()}}return e.highlight.custom&&e.highlight.custom.forEach(function(e,t){addSquare(r,t,e)}),r}function addSquare(e,t,r){var n=e.get(t);n?e.set(t,"".concat(n," ").concat(r)):e.set(t,r)}function appendValue(e,t,r){var n=e.get(t);n?n.push(r):e.set(t,[r])}function syncShapes(e,t,r){var n,o=new Map,a=[],i=_createForOfIteratorHelper(e);try{for(i.s();!(n=i.n()).done;){var s=n.value;o.set(s.hash,!1)}}catch(e){i.e(e)}finally{i.f()}for(var l,c=t.firstElementChild;c;)l=c.getAttribute("cgHash"),o.has(l)?o.set(l,!0):a.push(c),c=c.nextElementSibling;for(var u=0,d=a;u<d.length;u++)t.removeChild(d[u]);var p,f=_createForOfIteratorHelper(e);try{for(f.s();!(p=f.n()).done;){var v=p.value;o.get(v.hash)||t.appendChild(r(v))}}catch(e){f.e(e)}finally{f.f()}}function render(t,e){syncShapes(t.drawable.autoShapes.filter(function(e){return e.piece}).map(function(e){return{shape:e,hash:hash(e),current:!1}}),e,function(e){return renderShape(t,e,t.dom.bounds())})}function renderResized(e){for(var t=whitePov(e),r=posToTranslate(e.dom.bounds()),n=null==(e=e.dom.elements.autoPieces)?void 0:e.firstChild;n;)translateAndScale(n,r(key2pos(n.cgKey),t),n.cgScale),n=n.nextSibling}function renderShape(e,t,r){var n=t.shape,t=t.hash,o=n.orig,a=null==(a=n.piece)?void 0:a.role,i=null==(i=n.piece)?void 0:i.color,n=null==(n=n.piece)?void 0:n.scale,a=createEl("piece","".concat(a," ").concat(i));return a.setAttribute("cgHash",t),a.cgKey=o,a.cgScale=n,translateAndScale(a,posToTranslate(r)(key2pos(o),whitePov(e)),n),a}var hash=function(e){var t;return[e.orig,null==(t=e.piece)?void 0:t.role,null==(t=e.piece)?void 0:t.color,null==(t=e.piece)?void 0:t.scale].join(",")};function Chessground(i,e){var s=defaults();function t(){function e(e){render$1(a),n.autoPieces&&render(a,n.autoPieces),!e&&n.svg&&renderSvg(a,n.svg,n.customSvg)}function t(){updateBounds(a),renderResized$1(a),n.autoPieces&&renderResized(a)}var r="dom"in s?s.dom.unbind:void 0,n=renderWrap(i,s),o=memo(function(){return n.board.getBoundingClientRect()}),a=s;return a.dom={elements:n,bounds:o,redraw:debounceRedraw(e),redrawNow:e,unbind:r},a.drawable.prevSvgHash="",updateBounds(a),e(!1),bindBoard(a,t),r||(a.dom.unbind=bindDocument(a,t)),a.events.insert&&a.events.insert(n),a}return configure(s,e||{}),start(t(),t)}function debounceRedraw(e){var t=!1;return function(){t||(t=!0,requestAnimationFrame(function(){e(),t=!1}))}}const palco=document.createElement("div");palco.classList.add("blue"),palco.classList.add("merida"),fetch("http://localhost:5026").then(e=>e.json()).then(e=>{var t=document.createElement("div"),r=(palco.classList.add("palco"),document.createElement("div")),r=(r.classList.add("blackPlayer"),r.innerHTML=e.game.black.preferredName,palco.appendChild(r),palco.append(t),document.createElement("div"));r.classList.add("whitePlayer"),r.innerHTML=e.game.white.preferredName,palco.appendChild(r),document.body.append(palco),Chessground(t,{fen:e.game.currentFEN,viewOnly:!0,animation:{duration:1e3},movable:{free:!1},drawable:{visible:!1}})});
